Using device: mps
Loading dataset...
Scanning 2 videos...
Scanning videos: 100%|████████████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00, 156.68it/s]
Total frames available: 125048
Train set: 106291 frames
Test set: 18757 frames
Creating VAE model...
VAE model created with 129,467,600 parameters
Starting training...
Epoch 1/100 [Train]:   0%|                                                                         | 0/13287 [00:00<?, ?it/s]/Users/tsuberim/Projects/open-oasis/.venv/lib/python3.13/site-packages/torch/utils/data/dataloader.py:683: UserWarning: 'pin_memory' argument is set as true but not supported on MPS now, then device pinned memory won't be used.
  warnings.warn(warn_msg)
Epoch 1/100 [Train]:   1%|▏                      | 117/13287 [03:10<5:56:46,  1.63s/it, loss=0.0442, recon=0.0418, kl=0.0024]
Traceback (most recent call last):
  File "/Users/tsuberim/Projects/open-oasis/train_vae.py", line 427, in <module>
    main()
    ~~~~^^
  File "/Users/tsuberim/Projects/open-oasis/train_vae.py", line 413, in main
    train_vae(
    ~~~~~~~~~^
        model=model,
        ^^^^^^^^^^^^
    ...<6 lines>...
        resume_path=args.resume
        ^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tsuberim/Projects/open-oasis/train_vae.py", line 141, in train_vae
    recon, posterior, latent = model.autoencode(frames, sample_posterior=True)
                               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tsuberim/Projects/open-oasis/vae.py", line 319, in autoencode
    dec = self.decode(z)
  File "/Users/tsuberim/Projects/open-oasis/vae.py", line 303, in decode
    z = blk(z)
  File "/Users/tsuberim/Projects/open-oasis/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/tsuberim/Projects/open-oasis/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/tsuberim/Projects/open-oasis/vae.py", line 144, in forward
    x = x + self.attn(self.norm1(x))
            ~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/tsuberim/Projects/open-oasis/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/tsuberim/Projects/open-oasis/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/tsuberim/Projects/open-oasis/vae.py", line 99, in forward
    q = apply_rotary_emb(self.rotary_freqs, q)
  File "/Users/tsuberim/Projects/open-oasis/.venv/lib/python3.13/site-packages/torch/amp/autocast_mode.py", line 44, in decorate_autocast
    return func(*args, **kwargs)
  File "/Users/tsuberim/Projects/open-oasis/rotary_embedding_torch.py", line 65, in apply_rotary_emb
    t_transformed = (t_middle * freqs.cos() * scale) + (rotate_half(t_middle) * freqs.sin() * scale)
                                                                                ~~~~~~~~~^^
KeyboardInterrupt
